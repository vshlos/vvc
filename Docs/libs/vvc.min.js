/*!
* VVC
*
* Author    Vlad Shlosberg
*/
window.vvc={makeClass:function(b){var c=function a(){if(this instanceof c){if(typeof this.init==="function"&&c.prototype.hasOwnProperty("init")){c.prototype.init.apply(this,arguments)}}else{var e=arguments;var d=function(){c.apply(this,e)};d.prototype=c.prototype;return new d()}};return c},makeNamespace:function(f){var e=f,b=window,c=null;if(typeof f==="string"){e=f.split(".")}else{if(!(f instanceof Array)){throw new Error("Argument has to either name namespace with separated by '.' or be an array of elements.")}}for(var d=0,a=e.length;d<a;d++){c=e[d];b=b[c]=b[c]||{}}return b},registerAllTools:function(c){var a,b=vvc.jqueryTools;if(!c&&!c.fn){throw new Error("jQuery object not defined.")}if(!b){return}while(b.length>0){a=b.pop();c.fn[a.name]=function(){return vvc.toolConstructor(this,a.type,a.name,arguments)}}},registerTool:function(b,a){var c;if(!vvc.jqueryTools){vvc.jqueryTools=[]}vvc.jqueryTools.push({type:b,name:a});if(typeof jQuery!=="undefined"){c=jQuery}else{if(typeof $!=="undefined"){c=$}}if(c){vvc.registerAllTools(c)}},sliceArgs:function(a,b){return Array.prototype.slice.call(a,b)},toolConstructor:function(h,g,a,c){var f=c?c[0]:null,e=[],b,d=typeof f==="string";if(d){c=Array.prototype.slice.call(c);c.shift()}b=h.each(function(){var k=this,l=k[a],i,j;if(f==="destroy"){if(l){if(l.destroy){l.destroy()}delete k[a]}return}else{if(!l){l=k[a]=new g(k,!d?f:null)}}if(d){j=l[f];if(j!=null){i=j.apply(l,c)}}else{if(l.setOptions&&f!=null){l.setOptions(f)}}if(i!=null&&i!=$(k)){e.push(i)}});if(e.length>0){return e[0]}else{return b}},createStatic:function(b,a,d){var c=vvc.makeNamespace(b);c[a]=d},createClass:function(c,b,f,a){var d=vvc.makeNamespace(c);var e=d[b]=vvc.makeClass(d);e.name=b;e.prototype=a;e.prototype.__CLASS__=c+"."+b;if(f){vvc.registerTool(e,f)}return e},extendObject:function(d,c){var a={};for(var b in d){a[b]=d[b]}if(c){for(var b in c){a[b]=c[b]}}return a},extendClass:function(i,d,g,e,k){var l;var m;var a=vvc.makeNamespace(i);var j=a[d]=function c(){if(this instanceof j){var n=this.base=new l(this);e.apply(this,arguments);if(n!=this.base){n.base=this.base;this.base=n}if(j.prototype.hasOwnProperty("init")&&typeof j.prototype.init==="function"){j.prototype.init.apply(this,arguments)}}else{var o=arguments;var p=function(){j.apply(this,o)};p.prototype=j.prototype;return new p()}};j.name=d;var h=function(n){return function(){var o=this.__instance__,p=o.base;try{o.base=this.base;n.apply(o,arguments)}finally{o.base=p}}};m=function(){};m.prototype=e.prototype;l=function(n){this.__instance__=n};l.prototype=vvc.extendObject(j.prototype=new m());for(var b in k){var f=j.prototype[b];if(f){if(typeof f==="function"){l.prototype[b]=h(f)}else{l.prototype[b]=f}}j.prototype[b]=k[b]}j.prototype.__CLASS__=i+"."+d;if(g){vvc.registerTool(j,g)}return j}};vvc.createClass("vvc","defaultNavigationManager",null,{init:function(){this.routes={}},registerRoutes:function(c){var a;for(var b in c){a=c[b];if(b&&a){this.registerRoute(b,a)}}},registerRoute:function(g,e){var f=g,b=this.routes,c=null;if(typeof g==="string"){f=g.split("/")}else{if(!(g instanceof Array)){throw new Error("Argument has to either be a namespace separated by a dot ('.') or be an array of elements.")}}if(f.length==0){throw new Error("Path has to contain a valid ")}for(var d=0,a=f.length-1;d<a;d++){c=f[d];b=b[c]=b[c]||{}}b[f[f.length-1]]=e},showPage:function(c){var b=c.split("/").reverse();var a=this.routes;while(a&&typeof a!=="function"&&b.length>0){a=a[b.pop()]}if(a){a.apply(this.routes,b);return true}return false},start:function(){var a=this;if(typeof window.onhashchange!=="undefined"){window.onhashchange=function(){a._hashChanged()}}a._hashChanged()},_hashChanged:function(){var a=window.location.href.indexOf("#/"),b=a>0?window.location.href.substr(a+2):"/";return this.showPage(b)},redirect:function(){var c=Array.prototype.slice.call(arguments).join("/"),a=window.location.href.indexOf("#"),b=a>0?window.location.href.substr(0,a):window.location.href;window.location.href=b+"#/"+c}});vvc.navManager=new vvc.defaultNavigationManager();vvc.createClass("vvc","defaultPageManager",null,{controllerNamespace:"vvc.controllers",viewNamspace:"vvc.views",init:function(a,b){this.controllerBase=a;this.controllerBase.prototype.manager=this;this.viewBase=b;this.viewBase.prototype.manager=this;this.controllers={};this.views={};this.partials={};this.currentView=null},controller:function(b,a){var c;if((!b||b=="")&&this.controllers[""]){throw new Error("Controller name is required. Only one default controller can exist.")}c=vvc.extendClass(this.controllerNamespace,b||"default",null,this.controllerBase,a);this.controllers[b||""]=c},view:function(b,a){var e,c,d=this.viewNamspace;if(!b||b==""){throw new Error("View name not defined")}c=b.lastIndexOf(".");if(c>0){d+="."+b.substr(0,c);b=b.substr(c+1)}e=vvc.extendClass(d,b,null,this.viewBase,a);this.views[b]=e},partial:function(b,a){var e,c,d=this.viewNamspace;if(!b||b==""){throw new Error("View name not defined")}c=b.lastIndexOf(".");if(c>0){d+="."+b.substr(0,c);b=b.substr(c+1)}e=vvc.extendClass(d,b,null,this.viewBase,a);this.partials[b]=e},model:function(a){},displayPage:function(f,e){var d=e.split("/").reverse(),b=this.controllers,c=vvc.sliceArgs(arguments,2);while(typeof b!=="function"&&b!=null&&d.length>0){b=b[d.pop()]}var a=new b();b=a;while(typeof b!=="function"&&b!=null&&d.length>0){b=b[d.pop()]}if(!b){return null}if(c){d=d.concat(c)}a.target=f;return b.apply(a,d)},displayView:function(b,a){if(!a||typeof a!=="function"){throw new Error("View is not defined as a view function class.")}if(!b){throw new Error("Target is not defined")}return b.vvc.showView.apply(b.vvc,[a].concat(vvc.sliceArgs(arguments,2)))},partialView:function(a,c){if(!a||typeof a!=="function"){throw new Error("View is not defined as a view function class.")}var b=new a();return b.show(c)}});vvc.createClass("vvc.controllers","base",null,{view:function(a,b){if(!this.manager){throw new Error("View manager was not initialized")}return this.manager.displayView(this.target,a,b)}});vvc.createClass("vvc.views","base",null,{navigate:function(c,a,b){this.manager.displayPage(c,a,b)},partialView:function(a,b){return this.manager.partialView(a,b)},redirect:function(a){}});vvc.pageManager=new vvc.defaultPageManager(vvc.controllers.base,vvc.views.base);vvc.createClass("vvc","targetHelper","vvc",{init:function(a){this.target=a;this.currentView=null;this.manager=vvc.pageManager},navigate:function(a,b){this.manager.displayPage(this.target,a,b)},showView:function(a,c){if(this.currentView){this.currentView.hide()}var b=new a();b.target=this.target;b.show(this.target,c);this.currentView=b},bindNavigate:function(d,a,b){var c=this;$(this.target).bind(d,function(e){c.manager.displayPage(c.target,a,b);e.preventDefault()})},clickNavigate:function(a,b){this.bindNavigate("click",a,b)},createLink:function(a){$(this.target).attr("href","#"+a)}});